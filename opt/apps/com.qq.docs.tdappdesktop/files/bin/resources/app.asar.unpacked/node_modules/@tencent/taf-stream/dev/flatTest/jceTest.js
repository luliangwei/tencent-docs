/**
 * Created by czzou on 2017/10/23.
 */
var Taf = require("../../libjce");
var DecodeTest = require("./DecodeTestProxy.js").DecodeTest;

var testStr = "测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码" +
    "测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码" +
    "测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码测试解码";

var temp = new DecodeTest.TestStruct();
temp.int1 = 555;
temp.int2 = 555;
temp.str1 = testStr;
temp.str2 = testStr;
var ost = new Taf.JceOutputStream();
ost.writeStruct(1, temp);
var binBuffer = ost.getBinBuffer();

var startTime = new Date().getTime();
var decodeTimes = 1000000;
for(var i = 0; i<decodeTimes; i++){
    decode(binBuffer);
}
var endTime = new Date().getTime();
console.log("jce解码次数：",decodeTimes);
console.log("耗时：", (endTime - startTime), "ms");


//jce协议特点：一次性解码struct，访问一个字段的时候，必须解码整个sturct
// 1⃣️ 访问属性个数不影响解码速度
// 2⃣️ 其他字段个数，字段内容大小影响解码速度
function decode(data) {
    var ist = new Taf.JceInputStream(data);
    var tst = ist.readStruct(1, true, DecodeTest.TestStruct);
    var str = tst.str1;
    var str2 = tst.str2;
    console.log(str,str2);
}
