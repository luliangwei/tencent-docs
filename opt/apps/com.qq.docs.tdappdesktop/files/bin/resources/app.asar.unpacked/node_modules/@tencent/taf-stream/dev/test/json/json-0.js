var fs        = require("fs");
var TafStream = require("../../../");
var GameA     = require("../jce/GameAJce.js").MiniGame;

var a = new GameA.TUserInfo();

//STEP01 设置基础变量数据
a.var_short = 1111;

//STEP02 设置结构体
a.st1.gameID = 2222;

a.st2.ID = 333333;
a.st2.sDesc = "FOR TEST";

//STEP03 设置MAP数据
//**map1
a.map1.insert("map1-key-1", "11111");
a.map1.insert("map1-key-2", "22222");

//**map2
var st1 = new GameA.TCoinDesc();
st1.gameID = 22222;

var st2 = new GameA.TCoinDesc();
st2.gameID = 33333;

a.map2.insert("map2-key-1", st1);
a.map2.insert("map2-key-2", st2);

//**map3
st1 = new GameA.TCoinDesc();
st1.gameID = 11111;

st2 = new GameA.TCoinDesc();
st2.gameID = 22222;

var m   = new TafStream.Map(TafStream.String, GameA.TCoinDesc);
m.insert("map3-key-1-key-1", st1);
m.insert("map3-key-1-key-2", st2);

a.map3.insert("map3-key-1", m);

//**map4
st1 = new GameA.TCoinDesc();
st1.gameID = 1111111;

st2 = new GameA.TCoinDesc();
st2.gameID = 2222222;

var st3 = new GameA.TCoinDesc();
st3.gameID = 3333333;

var list1 = new TafStream.List(GameA.TCoinDesc);
list1.push(st1);

var list2 = new TafStream.List(GameA.TCoinDesc);
list2.push(st2);
list2.push(st3);

a.map4.insert(11, list1);
a.map4.insert(22, list2);

//**map5
list1 = new TafStream.List(TafStream.String);
list1.push("map5-key-1-value-1");
list1.push("map5-key-1-value-2");

list2 = new TafStream.List(TafStream.String);
list2.push("map5-key-2-value-1");
list2.push("map5-key-2-value-2");

a.map5.insert("map5-key-1", list1);
a.map5.insert("map5-key-2", list2);

//STEP04 设置VECTOR数据
//**list1
a.list1.push("list1-value-1");
a.list1.push("list1-value-2");
a.list1.push("list1-value-3");

//**list2
st1 = new GameA.TCoinDesc();
st1.gameID = 111111;

st2 = new GameA.TCoinDesc();
st2.gameID = 222222;

a.list2.push(st1);
a.list2.push(st2);

//**list3
a.list3.writeUInt8(1);
a.list3.writeInt8(-2);

//**list4
var va = new TafStream.BinBuffer();
va.writeInt32(123456);

var vb = new TafStream.BinBuffer();
vb.writeInt32(223456);

a.list4.push(va);
a.list4.push(vb);

//**list5
list1 = new TafStream.List(GameA.TCoinDesc);
st1   = new GameA.TCoinDesc();
st1.gameID = 5555555;

st2   = new GameA.TCoinDesc();
st2.gameID = 6666666;

list1.push(st1);
list1.push(st2);

list2 = new TafStream.List(GameA.TCoinDesc);
st1   = new GameA.TCoinDesc();
st1.gameID = 7777777;

st2   = new GameA.TCoinDesc();
st2.gameID = 8888888;

list2.push(st1);
list2.push(st2);

a.list5.push(list1);
a.list5.push(list2);

//STEP05 输出最终结果
console.log("==========================================TO OBJECT BEGIN===============================================");
console.log(a.toObject());
console.log("==========================================TO OBJECT END=================================================\n");

console.log("==========================================JSON.stringify BEGIN==========================================");
console.log(JSON.stringify(a.toObject()));
fs.writeFileSync("./json.json", JSON.stringify(a.toObject()));
console.log("==========================================JSON.stringify END============================================\n");

console.log("==========================================JCE STREAM BEGIN===============================================");
var os = new TafStream.JceOutputStream();
os.writeStruct(0, a);
os.getBinBuffer().print();
console.log("==========================================JCE STREAM END=================================================\n");

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//开始解析
var c = a.toObject();

var b = new GameA.TUserInfo();
b.readFromObject(c);

var t1 = b.list4.at(0);
t1.position = 0;

var t2 = b.list4.at(1);
t2.position = 0;

console.log(t1.readInt32());
console.log(t2.readInt32());

//console.log("###1", b.map3.get("map").get("st1"));

//console.log("o:", b.mapCoins1.get("ccc").toObject);
//console.log("o:", b.mapCoins1.get("ccc"));

os = new TafStream.JceOutputStream();
os.writeStruct(0, b);
os.getBinBuffer().print();
